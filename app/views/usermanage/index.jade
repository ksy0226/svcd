extends ../layouts/default
block head
    //script(src='../../util/nodemailer.js', type='text/javascript')
    script(type='text/javascript').
        $(function(){
            $("#sendmail").click(function(){
                var formData = $("#usermanage").serialize();
                $("#msg").text("Email sending Please wait..");
                $.ajax({
                    type: "GET",
                    url: "/usermanage/sendmail",
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    dataType: "json",
                    success: function(data, status) {
                        $("#msg").empty().text(status);
                    },
                    error: function(e) {
                        fnJsonToEmail(data);
                        $("#msg").empty().text("Error to send email, Error code: ["+ e.status +"], Error message: ["+ e.statusText +"]");
                        //$("#msg").empty().text("data: "+data+", status: "+status);
                        return;
                    },
                    timeout: 60000
                });

                function fnJsonToEmail(JsonData){
                    alert(data);
                }
            });
        });

block content
    .content
            .container
                .row(style='margin-top:20px')
                    .col-xs-12.col-sm-10.col-md-8
                        h3.masthead-brand 사원정보관리(내외) > 리스트 조회
                        hr.colorgraph
                form.form.col-md-12.center-block(id='usermanage' name='form' action='/usermanage/new' method='post')
                    .row(style='margin-top:-15px')
                        .col-xs-3.col-sm-3.col-md-3
                            a.btn.btn-primary(href='/usermanage/new')
                                | 추가 
                            // Button trigger modal
                            a.btn.btn-info(data-target='#myModal', data-toggle='modal') mailer
                            #myModal.modal.fade(role='dialog', aria-hidden='true', aria-labelledby='myModalLabel', tabindex='-1')
                                .modal-dialog
                                    .modal-content
                                        .modal-header
                                            button.close(data-dismiss='modal', type='button', aria-hidden='true') &times;
                                            h4#myModalLabel.modal-title 메일 전송
                                            p#msg.bg-info
                                                form.form-horizontal(id='emailForm', role='form', method='post')
                                                    .form-group
                                                        label.control-label.col-sm-2(for='email') Email:
                                                        .col-sm-10
                                                            input.form-control(name='usermanage[email]', type='email', placeholder='Enter email')
                                                    .form-group
                                                        label.control-label.col-sm-2(for='subject') Subject:
                                                        .col-sm-10
                                                            input.form-control(name='usermanage[subject]', type='text', placeholder='Enter subject')
                                                    .form-group
                                                        label.control-label.col-sm-2(for='description') Description:
                                                        .col-sm-10
                                                            textarea.form-control(name='usermanage[description]', placeholder='Enter Description')
                                        .modal-footer
                                            button.btn.btn-default(data-dismiss='modal', type='button') 취소
                                            button.btn.btn-primary(id='sendmail' type='button') 보내기
                                                span.glyphicon.glyphicon-send
                        .col-xs-3.col-sm-3.col-md-3
                            input.form-control(id='searchText' name='usermanage[searchText]' type='text')
                        .col-xs-2.col-sm-2.col-md-2
                            .dropdown
                                button.btn.btn-default.dropdown-toggle(data-toggle='dropdown' type='button') 검색유형
                                    span.span.caret
                                ul.dropdown-menu.dropdown-menu(role='menu', aria-labelledby='menu1')
                                    li(role='presentation')
                                        a(data-type='title,content', href='#', role='menuitem', tabindex='-1') 제목,본문
                                    li(role='presentation')
                                        a(data-type='title', href='#', role='menuitem', tabindex='-1') 제목
                                    li(role='presentation')
                                        a(data-type='content', href='#', role='menuitem', tabindex='-1') 본문
                    .row(style='margin-top:20px') 
                        .col-xs-12.col-sm-10.col-md-8
                            table.table.table-striped
                                thead
                                    tr
                                        th.stretch 회사명
                                        th 아이디
                                        th 사원명
                                        th 부서명
                                        th 직위
                                        th 직책
                                        th 핸드폰번호
                                tbody
                                    - if (usermanage.length > 0) {
                                        // - for( var i = 0 ; length = usermanage.length > i ; i++ ){ //속도가 빠르다고 알고 있음.
                                        - for( var i in usermanage ){ //속도가 느리다고 알고 있음.
                                            tr(onclick="onclick=location.href='/usermanage/#{usermanage[i]._id}/edit'")
                                                td.highlight(data-highlight='search.highlight.title') #{usermanage[i].compannyNm}
                                                td #{usermanage[i].userId}
                                                td #{usermanage[i].userNm}
                                                td #{usermanage[i].deptNm}
                                                td #{usermanage[i].jikwe}
                                                td #{usermanage[i].jikchk}
                                                td #{usermanage[i].hpNo}
                                        - }
                                    - }else{
                                        tr
                                            td(colspan='5' align='center') 조회된 데이타가 없습니다.
                                    - }